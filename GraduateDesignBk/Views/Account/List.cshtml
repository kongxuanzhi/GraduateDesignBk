@model GraduateDesignBk.Models.SearchAndPage
@{
    ViewBag.Title = "List";
    int num = 0;
}
<style>
    hr {
        border: 1px solid #cccccc;
        margin-bottom: 0px;
    }
    .bkOnBlur{
        background-color:#8aa742;
    }
</style>   
@using (Html.BeginForm("List", "Account", new { userType = @Model.userType }, FormMethod.Post, new { id = "form_Search", @class = "form-inline" }))
{
    <input type="hidden" id="pagesize" name="PageSize"  value="@Model.PageSize" />
    <input type="hidden" id="CurIndex" name="CurIndex" value="@Model.CurIndex" />
    <input type="hidden" name="type" value="@Model.type" />

    <div class="form-group">
        <a href="javascript:void(0)" onclick="showSetting()">
            <span class="glyphicon glyphicon-cog btn-lg" aria-hidden="true"></span>
        </a>
    </div>
    <div class="form-group">
        @Html.EditorFor(model => model.SerachRealName, new { htmlAttributes = new { placeholder = "姓名", @class = "form-control" } })
    </div>
    <div class="form-group">
        @Html.EditorFor(model => model.SearchName, new { htmlAttributes = new { placeholder = "通号", @class = "form-control" } })
    </div>
    if (Model.userType != "教师")
    {
        <div class="form-group">
            @Html.EnumDropDownListFor(model => model.SearchLevel, "--学级--", htmlAttributes: new { @class = "form-control" })
        </div>
    }
    <div class="form-group">
        @Html.EnumDropDownListFor(model => model.SearchMayor, "--专业--", htmlAttributes: new { @class = "form-control" })
    </div>
    <a href="#" onclick="getPageSize(0)" class="btn btn-default"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span>搜 索</a>
}
<script>
    function getPageSize(type) {
        if (type == 1) {
            $("#CurIndex").val($("#CurIndex").val() - 1);
        } else if (type == 2)
        {
            $("#CurIndex").val($("#CurIndex").val() - (-1));
        }
        $("#pagesize").val($("#PageSize").val());
        $("#form_Search").submit();
    }
</script>
<div id="settings" class="hidden">
    @using (Html.BeginForm("DeleteUser", "Account", new { RoleName = @Model.userType }, FormMethod.Post, new { id = "form_DeleteUser" }))
    {
        <label for="Totalselect" class="btn btn-default">全 选</label>
        <input type="checkbox" id="Totalselect" onclick="CheckDelete()" />
        @Html.ActionLink("添加", "AddNewUser", new { roleType = @Model.userType, }, htmlAttributes: new { @class = "btn btn-default" })
        <input type="hidden" id="DeleteUser"  name="Ids" value="" />
        <a href="javascript:Submit('DeleteUser');" onclick="return confirm('你确定要删除这些成员吗？')" class="btn btn-default" >删除</a>
        if (@Model.type == "UnGroupList")
        {
            <a href="javascript:Submit('AddUserToRole');" class="btn btn-default">添加到该角色</a>
        }
        else
        {
            <a href="javascript:Submit('RemoveUserFromRole');" onclick="return confirm('你确定要移除这些成员吗？')" class="btn btn-default">移除</a>
        }
    }

    @using (Html.BeginForm("AddUserToRole", "Account", new { roleName = @Model.userType }, FormMethod.Post, new { id = "form_AddUserToRole" }))
    {
        <input type="hidden" id="AddUserToRole" name="userIds" value="" />
    }

    @using (Html.BeginForm("RemoveUserFromRole", "Role", new { roleName = @Model.userType }, FormMethod.Post, new { id = "form_RemoveUserFromRole" }))
    {
        <input type="hidden" id="RemoveUserFromRole" name="Id" value="" />
    }
</div>
<hr />
<div class="row">
    @foreach (var item in Model.UserItems)
    {
        if (num % 4 == 0) {
          @:<div class="row"></div>
        }
        num += 1;
        string comment = @item.Comment;

        <div class="col-md-3" style="border:ridge;">
            <div class="row">
                <div class="col-md-6">
                    <label for="@item.Id" >
                        <span style="cursor:pointer;"  onclick="onFouces(this)">
                            <span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span>
                            <img class="img-responsive" style="width:100%;" src="@item.Photo" />
                        </span>
                    </label>
                </div>
                <input type="checkbox" style="width:16px" value="@item.Id" id="@item.Id" name="delId" />
                <div class="col-md-6" style="padding-top:20px;padding-right:0px;font-size:smaller;padding-left:2px">
                    <div>
                        <b>姓名：</b>@Html.DisplayFor(modelItem => item.RealName)
                    </div>
                    <div>
                        <b>通号：</b>@Html.DisplayFor(modelItem => item.UserName)
                    </div>
                    <div>
                        <b> 年级：</b>@Html.DisplayFor(modelItem => item.level)
                    </div>
                    <div>
                        <b>专业：</b>@Html.DisplayFor(modelItem => item.mayjor)
                    </div>
                </div>
            </div>
            <hr/>
            <div>
                <div>
                    <b><i>评语：</i></b>
                    <p>
                        &nbsp; &nbsp;@comment.Substring(0, @comment.Length > 20 ? 20 : @comment.Length)...
                    </p>
                </div>
                <div style="height:21px;">
                    @using (Html.BeginForm("DeleteUser", "Account", new { Ids = @item.Id, RoleName = @Model.userType }, FormMethod.Post, new { id = "from" + @item.Id }))
                    {
                        <a href="javascript:$('#from@(item.Id)' ).submit();"  onclick="return confirm('确定要删除该成员吗？')" class="left glyphicon glyphicon-remove"></a>
                    }
                    <a class="right" href="http://go.microsoft.com/fwlink/?LinkId=301865"><span class=" glyphicon glyphicon-hand-right" aria-hidden="true"></span></a>
                </div>
            </div>
        </div>
}
</div>
    
<div class="row">
    <nav>
        <ul class="pager">
            <li class="left">
                @Html.EnumDropDownListFor(model => model.PageSize, htmlAttributes: new { @class = "form-control"})
            </li>
            @if (Model.CurIndex>1)
            {
                <li>
                    <a href="#" onclick="getPageSize(1)">上一页</a>
                </li>
            }
            @if (Model.CurIndex < Model.PageNum)
            {
                <li>
                    <a href="#" onclick="getPageSize(2)">下一页</a>
                </li>
            }
            <li class="right">  当前第  @Model.CurIndex 页 总共: @Model.PageNum 页共 @Model.TotalCount 条记录</li>
        </ul>
    </nav>
</div>

<script>
   
    

    function showSetting() {
        if ($("#settings").hasClass("hidden")) {
            $("#settings").removeClass("hidden");
        } else {
            $("#settings").addClass("hidden");
        }
    }

    function CheckDelete() {
        var allCheck = document.getElementById("Totalselect");
        var check = document.getElementsByName("delId");
        if (allCheck.checked == false) {
            allCheck.checked = false;
            for (var i = 0; i < check.length; i++) {
                check[i].checked = false;
            }
            return;
        }
        else {
            for (var i = 0; i < check.length; i++) {
                check[i].checked = true;
            }
        }
    }

    function onFouces(obj) {
        var block = $(obj).parent().parent().parent().parent();
        if (block.hasClass("bkOnBlur")) {
            block.removeClass("bkOnBlur");
        }
        else
            block.addClass("bkOnBlur");
    }

    function getIds() {
        var ids = "";
        var check = document.getElementsByName("delId");
        for (var i = 0; i < check.length; i++) {
            if (check[i].checked == true) {
                ids += check[i].value + "|";
            }
        }
        return ids.substring(0,ids.length-1);
    }
    function Submit(name) {
        var ids = getIds();
        if (ids != "") {
            $("#" + name).val(ids);
            $('#form_' + name).submit();
        } else {
            alert("你未选中任何选项！");
        }
    }



</script>